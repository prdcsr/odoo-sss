<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <report
            string="DBM Sparepart"
            id="action_dbm_sparepart"
            model="stock.picking"
            report_type="qweb-pdf"
            name="zz_sss.report_dbm_sparepart"
            file="zz_sss.report_dbm_sparepart"
            print_report_name="'DBM Sparepart - %s - %s' % (object.partner_id.name or '', object.name)"
    />

    <template id="report_dbm_sparepart">
        <!-- <t t-call="web.html_container"> -->
        <t t-foreach="docs" t-as="o">
            <t t-call="zz_sss.report_dbm_sparepart_document" t-lang="o.partner_id.lang"/>
        </t>
        <!-- </t> -->
    </template>

    <template id="report_dbm_sparepart_document">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
                <t t-set="partner" t-value="o.partner_id or (o.move_lines and o.move_lines[0].partner_id) or False"/>
                <t t-if="partner and o.picking_type_id.code!='incoming'" name="partner_header">
                    <t t-set="address">
                        <div t-esc="partner"
                             t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True}"/>
                    </t>
                </t>
                <div class="page">
                    <h2>
                        <span t-field="o.name"/>
                    </h2>
                    <div class="row mt32 mb32">
                        <div t-if="o.origin" class="col-auto" name="div_origin">
                            <strong>
                                Order:
                            </strong>
                            <p t-field="o.origin"/>
                        </div>
                        <div t-if="o.no_container" class="col-auto" name="div_container">
                            <strong>
                                No Container:
                            </strong>
                            <p t-field="o.no_container"/>
                        </div>
                        <div t-if="o.picking_type_id.code !='incoming'" class="col-auto" name="div_from">
                            <strong>
                                From :
                            </strong>
                            <p t-field="o.location_id"/>
                        </div>
                        <div t-if="o.picking_type_id.code !='outgoing'" class="col-auto" name="div_to">
                            <strong>
                                To :
                            </strong>
                            <p t-field="o.location_dest_id"/>
                        </div>
                        <div t-if="o.user_id" class="col-auto" name="div_user">
                            <strong>
                                Create By :
                            </strong>
                            <p t-field="o.user_id"/>
                        </div>
                        <div t-if="o.purchase_id" class="col-auto" name="div_bl_no">
                            <strong>
                                B/L No :
                            </strong>
                            <p t-field="o.purchase_id.bl_no"/>
                        </div>
                        <div t-if="o.purchase_id" class="col-auto" name="div_bl_date">
                            <strong>
                                B/L Date :
                            </strong>
                            <p t-field="o.purchase_id.bl_date"/>
                        </div>
                        <div t-if="o.purchase_id" class="col-auto" name="div_bl_date">
                            <strong>
                                Warehouse :
                            </strong>
                            <p t-field="o.purchase_id.picking_type_id.warehouse_id"/>
                        </div>
                        <div t-if="o.state" class="col-auto" name="div_sched_date">
                            <strong>
                                Date:
                            </strong>
                            <t t-if="o.state == 'done'">
                                <p t-field="o.date_done" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                            </t>
                            <t t-if="o.state != 'done'">
                                <p t-field="o.scheduled_date" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
                            </t>
                        </div>
                    </div>
                    <table class="table table-sm" t-if="o.state!='done'" name="stock_move_table">
                        <thead>
                            <tr>
                                <th name="th_sm_product">
                                    <strong>
                                        Product
                                    </strong>
                                </th>
                                <th name="th_sm_quantity">
                                    <strong>
                                        Quantity
                                    </strong>
                                </th>
                                <th name="th_sm_kelengkapan">
                                    <strong>
                                        Kelengkapan
                                    </strong>
                                </th>
                                <th name="th_sm_location">
                                    <strong>
                                        Location
                                    </strong>
                                </th>
                                <!-- <th> -->
                                <!-- <t t-if="line_ids.product_id.categ_id.parent_id.name == 'SPAREPART'"> -->
                                <!-- <strong>Location</strong> -->
                                <!-- </t> -->
                                <!-- <t t-else=""> -->
                                <!-- <span></span> -->
                                <!-- </t> -->
                                <!-- </th> -->
                                <th name="th_sm_Keterangan">
                                    <strong>
                                        Keterangan
                                    </strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)"/>
                            <tr t-foreach="lines" t-as="move">
                                <td>
                                    <span t-field="move.product_id"/>
                                    <!-- <p t-if="move.description_picking != move.product_id"> -->
                                    <p t-if="move.description_picking != move.product_id.name">
                                        <span t-field="move.description_picking"/>
                                    </p>
                                </td>
                                <td>
                                    <span t-esc="int(move.product_uom_qty)"/>
                                    <span t-field="move.product_uom"/>
                                </td>
                                <td>
                                    <span t-field="move.product_id.description_pickingout"/>
                                </td>
                                <td>
                                    <span t-field="move.product_id.description_picking"/>
                                </td>
                                <td>
                                    <span t-field="move.product_id.description_pickingin"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm mt48" t-if="o.move_line_ids and o.state=='done'"
                           name="stock_move_line_table">
                        <t t-set="has_serial_number" t-value="o.move_line_ids.mapped('lot_id')"/>
                        <thead>
                            <tr>
                                <th>
                                    <strong>
                                        No
                                    </strong>
                                </th>
                                <th name="th_sml_product">
                                    <strong>
                                        Product
                                    </strong>
                                </th>
                                <th name="th_sml_quantity" class="text-center">
                                    <strong>
                                        Quantity Purchased
                                    </strong>
                                </th>
                                <th name="th_sml_quantity" class="text-center">
                                    <strong>
                                        Quantity Received
                                    </strong>
                                </th>
                                <th name="lot_serial" t-if="has_serial_number"
                                    groups="stock.group_lot_on_delivery_slip">
                                    Lot/Serial Number
                                </th>
                                <th name="th_sm_kelengkapan">
                                    <strong>
                                        Kelengkapan
                                    </strong>
                                </th>
                                <th name="th_sm_location">
                                    <strong>
                                        Location
                                    </strong>
                                </th>
                                <th name="th_sm_Keterangan">
                                    <strong>
                                        Keterangan
                                    </strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="i" t-value="1"/>
                            <!-- t t-foreach="o.move_line_ids.sorted(key=lambda m: m.sequence)" t-as="move_line" -->
                            <t t-foreach="o.move_line_ids.sorted(key=lambda m: m.move_id.sequence)" t-as="move_line">
                                <tr t-if="move_line.qty_done &gt; 0 and move_line.product_id.type=='product'">
                                    <td>
                                        <span t-esc="i"/>
                                    </td>
                                    <t t-set="i" t-value="i+1"/>
                                    <td>
                                        <span t-field="move_line.product_id"/>
                                        <p t-if="move_line.move_id.description_picking != move_line.product_id.name">
                                            <span t-field="move_line.move_id.description_picking"/>
                                        </p>
                                    </td>
                                    <td t-if="has_serial_number and move_line.lot_id.name"
                                        groups="stock.group_lot_on_delivery_slip">
                                        <span t-field="move_line.lot_id.name"/>
                                    </td>
                                    <td t-elif="has_serial_number" groups="stock.group_lot_on_delivery_slip">
                                        <span t-field="move_line.lot_name"/>
                                    </td>
                                    <td class="text-center">
                                        <span t-esc="int(move_line.qty_done)"/>
                                        <span t-field="move_line.product_uom_id"/>
                                    </td>
                                    <td/>
                                    <td>
                                        <span t-field="move_line.product_id._select_seller(partner_id=o.partner_id).product_specification"/>
                                        -
                                        <img style="max-width:100px;max-height:100px"
                                             t-attf-src="data:image/*;base64,{{move_line.product_id.image_1920}}"
                                             t-att-alt="product_image"/>
                                    </td>
                                    <td>
                                        <span t-field="move_line.product_id.description_picking"/>
                                    </td>
                                    <td style="background-color: white; border-right-color: white">
                                        <span t-field="move_line.product_id.description_pickingin"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    <strong>
                        Note :
                    </strong>
                    <p t-field="o.note"/>
                    <p id="Sign">
                        <!-- div class="col-4" -->
                        <table class="table table-sm o_main_table">
                            <tr>
                                <td class="text-center" name="ConfBy">
                                    <strong>
                                        Checked By
                                    </strong>
                                </td>
                                <!-- td class="text-center" name="ApprBy"><strong>Acknowledge By</strong></td -->
                            </tr>
                            <tr>
                                <td>
                                    <br>

                                    </br>
                                    <br>

                                    </br>
                                    <br>

                                    </br>
                                    <br>

                                    </br>
                                </td>
                                <!--
                                td>
                                <br>&#160;</br>
                                <br>&#160;</br>
                                <br>&#160;</br>
                                <br>&#160;</br>
                                </td
                                -->
                            </tr>
                        </table>
                    </p>
                    <!--
                    t t-if="o.backorder_ids and o.backorder_ids.filtered(lambda x: x.state not in ('done', 'cancel'))">
                    All items couldn't be shipped, the remaining ones will be shipped as soon as they become available.
                    </t
                    -->
                </div>
            </t>
        </t>
    </template>
</odoo>